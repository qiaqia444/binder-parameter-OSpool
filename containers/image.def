Bootstrap: docker
From: julia:1.11

%files
   Project.toml /opt/project/
   Manifest.toml /opt/project/

%post
    # Install any needed system packages first
    apt-get update -y
    apt-get install -y wget \
            git \
            cmake \
            g++ \
            build-essential

    # Set up Julia environment
    export JULIA_DEPOT_PATH="/opt/julia"
    
    # Install Julia packages in the project environment
    cd /opt/project
    julia --project=. -e 'using Pkg; Pkg.instantiate(); Pkg.precompile()'
    
    # Also install packages globally as backup
    julia -e 'using Pkg; Pkg.add(["ITensors", "ITensorMPS", "ITensorCorrelators", "ArgParse", "JSON", "DelimitedFiles", "Random", "Statistics"]); Pkg.precompile()'

%environment
    export JULIA_DEPOT_PATH="/opt/julia"
    export JULIA_PROJECT="/opt/project"
